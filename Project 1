
#Read in the household power consumption from the UCI website
if(file!exists("exdata-data-household_power_consumption.zip")){
  temp <- tempfile()
  download.file("http://d396qusza40orc.cloudfront.net/exdata%2Fdata%2Fhousehold_power_consumption.zip",temp)
  file <- unzip(temp)
  unlink(temp)
}

#Next we assign the variable for the dataset.  For this dataset I utilize the variable names hpc and HPC to stand for 
#household power consumption.
hpc <- read.table("household_power_consumption.txt", header=T, sep=";")

#Next we want to change the format to days, months years.  In the next part where I subset my data I found it more efficient 
#To change the date form to days month years, 
hpc$Date <- as.Date(hpc$Date, format="%d/%m/%Y")

#There are many dates in this file. We are going to restrict the dates to just 02/01/2007 to 02/02/2007 
#By subsetting the dates to just the two dates we are reviewing
HPC <- hpc[("2007-02-01"== hpc$Date)|("2007-02-02"==hpc$Date),]

#Here for the next column I want to convert my variables that I will be creating plots for from a factor
#To numbers which will make the plotting easier to graph
HPC$Global_active_power <- as.numeric(as.character(HPC$Global_active_power))
HPC$Global_intensity <- as.numeric(as.character(HPC$Global_intensity))
HPC$Voltage <- as.numeric(as.character(HPC$Voltage))
HPC$Global_reactive_power <- as.numeric(as.character(HPC$Global_reactive_power))
HPC$Sub_metering_1 <- as.numeric(as.character(HPC$Sub_metering_1))
HPC$Sub_metering_2 <- as.numeric(as.character(HPC$Sub_metering_2))
HPC$Sub_metering_3 <- as.numeric(as.character(HPC$Sub_metering_3))

#In this step i make sure to utilize the POSIXct function to get the timestamp
#In the form of day, month, year, hour minute second
HPC <- transform(HPC,timestamp=as.POSIXct(paste(Date,Time)), "%d/%m/%Y %H:%M:%S")


#This is the first plot where we utilize a histogram to show the Global Active power in kilowatts and the frequency
#In which they occurred during this time frame
HPC_Plot <- function() {
  hist(HPC$Global_active_power, main=paste("Global Active Power"), col="blue", xlab="Global Active Power (in Kilowatts)")
  dev.copy(png, file="HPC_Plot.png", width=480, heigh=480)
  dev.off()
  cat("HPC_Plot.png has been saved in", getwd())
}
HPC_Plot()

#Here we graph the global active power dependant over the days that they occur 
HPC_Plot2 <- function() {
  plot(HPC$timestamp, HPC$Global_active_power, type="l", xlab="", ylab="Global Active Power (in Kilowatts)")
  dev.copy(png, file="HPC_Plot2.png", width=480, height=480)
  dev.off()
  cat("HPC_Plot2.png has been saved in", getwd())
}
HPC_Plot2()

#This graph takes a look at the three meterings that occurred in that timeframe and graphs the function
HPC_Plot3 <- function() {
  plot(HPC$timestamp, HPC$Sub_metering_1, type="l", xlab="", ylab= "Energy sub metering")
  lines(HPC$timestamp, HPC$Sub_metering_2, col="red")
  lines(HPC$timestamp, HPC$Sub_metering_3, col="blue")
  legend("topright", col=c("black","red","blue"), c("Sub_metering_1","Sub_metering_2", "Sub_metering_3"),lty=c(1,1),lwd=c(1,1))
  dev.copy(png,file="HPC_Plot3.png", width=480, height=480)
  dev.off()
  cat("HPC_Plot3.png has been saved in", getwd())
}
HPC_Plot3()


HPC_Plot4 <- function() {
  par(mfrow=c(2,2))
  #Here we put four graphs onto the same graph.  Similar to an SG panel graph in SAS.  
  
  #Here is the first graph that we will utilize for our panels
plot(HPC$timestamp, HPC$Global_active_power, type="l", xlab="", ylab="Global Active Power")
  
#Here is the code for the second graph in our panel
plot(HPC$timestamp, HPC$Voltage, type="l", xlab="datetime",ylab="Voltage")

#Third HPC Plot is utilized here
plot(HPC$timestamp, HPC$Sub_metering_1, type="l", xlab="", ylab="Energy Sub Metering")
lines(HPC$timestamp, HPC$Sub_metering_2, col="red")
lines(HPC$timestamp, HPC$Sub_metering_3, col="blue")
legend("topright",col=c("black","blue", "red"), c("Sub_metering_1", "Sub_metering_2", "Sub_metering_3"), lty=c(1,1), 
       bty="n", cex=.5)
plot(HPC$timestamp, HPC$Global_reactive_power, type="l", xlab="datetime", ylab="Global_reactive_power")

dev.copy()
dev.off()
cat("HPC_Plot4.png has been saved in", getwd())
}
HPC_Plot4()
